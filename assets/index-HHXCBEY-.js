import{T as ft,H as _e}from"./ThemeToggle-2h4CMYGM.js";import{k as ie,c as P,i as g,a as m,n as pe,l as W,p as j,q as tt,b as l,r as h,o as nt,s as mt,v as je,d as M,e as A,w as s,T as pt,x as Be,y as B,z as Oe,A as Ke,B as Me,C as te,D as Ue,j as T,t as I,E as Ye,G as vt,H as gt,F as Ne,I as yt,J as kt,K as bt,L as wt,u as y,g as qe,M as xe,f as Tt,N as D,O as K}from"./index-DyArWEBF.js";import{_ as Ct}from"./xiaoyugan-CodOW0Y3.js";import ht from"./manual-CRBmaJS5.js";import St from"./url-BCrXX-jw.js";import{K as $t,E as _t,B as Bt,T as Ot}from"./bin-C_pczcFI.js";import{_ as Mt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ot,g as ke,i as ye,s as Re,a as Ve,b as Ut,c as xt,o as ve,d as Fe,I as zt,e as At,f as Et,h as Lt,j as Dt,B as lt,C as Pt,u as It,k as jt,l as Nt,m as Ft,n as ae,p as Xe,q as Ze,r as Wt,t as Rt,v as ze,w as Vt,x as Ht,y as Je}from"./index-CGiVfv3v.js";import{M as Gt}from"./index-Cgh3KRmE.js";import{C as Kt,S as Yt,T as qt,a as Xt}from"./index-Cu-38CWq.js";import{A as Qe}from"./Add-DW-yEGKj.js";import{M as Zt}from"./Menu-CuBJ3t4j.js";import{R as Ae}from"./Refresh-Da3U7XaG.js";import{E as et}from"./EllipsisHorizontal-i7TfOBf4.js";import{C as Jt}from"./Copy-BhnuMPaG.js";import"./AlertCircleOutline-W_Xt_yJs.js";import"./CloudUpload-D33L_pSL.js";import"./render-function-DCw9XyXb.js";const Qt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},en=m("path",{d:"M394 480a16 16 0 0 1-9.39-3L256 383.76L127.39 477a16 16 0 0 1-24.55-18.08L153 310.35L23 221.2a16 16 0 0 1 9-29.2h160.38l48.4-148.95a16 16 0 0 1 30.44 0l48.4 149H480a16 16 0 0 1 9.05 29.2L359 310.35l50.13 148.53A16 16 0 0 1 394 480z",fill:"currentColor"},null,-1),tn=[en],nn=ie({name:"Star",render:function(o,i){return g(),P("svg",Qt,tn)}}),on=ie({name:"IconInfoCircleFill",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:o}){const i=ke("icon"),r=j(()=>[i,`${i}-info-circle-fill`,{[`${i}-spin`]:e.spin}]),w=j(()=>{const c={};return e.size&&(c.fontSize=ye(e.size)?`${e.size}px`:e.size),e.rotate&&(c.transform=`rotate(${e.rotate}deg)`),c});return{cls:r,innerStyle:w,onClick:c=>{o("click",c)}}}}),ln=["stroke-width","stroke-linecap","stroke-linejoin"];function sn(e,o,i,r,w,a){return g(),P("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:W(e.cls),style:pe(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:o[0]||(o[0]=(...c)=>e.onClick&&e.onClick(...c))},o[1]||(o[1]=[m("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M24 44c11.046 0 20-8.954 20-20S35.046 4 24 4 4 12.954 4 24s8.954 20 20 20Zm2-30a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-2Zm0 17h1a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-6a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1h1v-8a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v11Z",fill:"currentColor",stroke:"none"},null,-1)]),14,ln)}var Ee=ot(on,[["render",sn]]);const an=Object.assign(Ee,{install:(e,o)=>{var i;const r=(i=o==null?void 0:o.iconPrefix)!=null?i:"";e.component(r+Ee.name,Ee)}}),rn=["red","orangered","orange","gold","lime","green","cyan","arcoblue","purple","pinkpurple","magenta","gray"],un=["normal","processing","success","warning","danger"];var Le=ie({name:"Badge",props:{text:{type:String},dot:{type:Boolean},dotStyle:{type:Object},maxCount:{type:Number,default:99},offset:{type:Array,default:()=>[]},color:{type:String},status:{type:String,validator:e=>un.includes(e)},count:{type:Number}},setup(e,{slots:o}){const{status:i,color:r,dotStyle:w,offset:a,text:c,dot:k,maxCount:b,count:d}=tt(e),f=ke("badge"),C=cn(f,i==null?void 0:i.value,o==null?void 0:o.default),O=j(()=>{const v={...(w==null?void 0:w.value)||{}},[p,x]=(a==null?void 0:a.value)||[];p&&(v.marginRight=`${-p}px`),x&&(v.marginTop=`${x}px`);const E=!(r!=null&&r.value)||rn.includes(r==null?void 0:r.value)?{}:{backgroundColor:r.value};return{mergedStyle:{...E,...v},computedDotStyle:v,computedColorStyle:E}}),U=()=>{const v=c==null?void 0:c.value,p=r==null?void 0:r.value,x=i==null?void 0:i.value,E=k==null?void 0:k.value,z=Number(d==null?void 0:d.value),R=(d==null?void 0:d.value)!=null,{computedDotStyle:Y,mergedStyle:F}=O.value;return o.content?l("span",{class:`${f}-custom-dot`,style:Y},[o.content()]):v&&!p&&!x?l("span",{class:`${f}-text`,style:Y},[v]):x||p&&!R?l("span",{class:`${f}-status-wrapper`},[l("span",{class:[`${f}-status-dot`,{[`${f}-status-${x}`]:x,[`${f}-color-${p}`]:p}],style:F},null),v&&l("span",{class:`${f}-status-text`},[v])]):(E||p)&&z>0?l("span",{class:[`${f}-dot`,{[`${f}-color-${p}`]:p}],style:F},null):z===0?null:l("span",{class:`${f}-number`,style:F},[l("span",null,[b.value&&z>b.value?`${b.value}+`:z])])};return()=>l("span",{class:C.value},[o.default&&o.default(),U()])}});const cn=(e,o,i)=>j(()=>[e,{[`${e}-status`]:o,[`${e}-no-children`]:!i}]),dn=Object.assign(Le,{install:(e,o)=>{Re(e,o);const i=Ve(o);e.component(i+Le.name,Le)}}),fn=e=>{const o=h(!1),i={overflow:"",width:"",boxSizing:""};return{setOverflowHidden:()=>{if(e.value){const a=e.value;if(!o.value&&a.style.overflow!=="hidden"){const c=Ut(a);(c>0||xt(a))&&(i.overflow=a.style.overflow,i.width=a.style.width,i.boxSizing=a.style.boxSizing,a.style.overflow="hidden",a.style.width=`${a.offsetWidth-c}px`,a.style.boxSizing="border-box",o.value=!0)}}},resetOverflow:()=>{if(e.value&&o.value){const a=e.value;a.style.overflow=i.overflow,a.style.width=i.width,a.style.boxSizing=i.boxSizing,o.value=!1}}}},mn=({modalRef:e,wrapperRef:o,draggable:i,alignCenter:r})=>{const w=h(!1),a=h([0,0]),c=h([0,0]),k=h(),b=h([0,0]),d=h([0,0]),f=()=>{var v,p,x;if(o.value&&e.value){const{top:E,left:z}=o.value.getBoundingClientRect(),{clientWidth:R,clientHeight:Y}=o.value,{top:F,left:q,width:X,height:Z}=e.value.getBoundingClientRect(),V=r.value?0:(v=e.value)==null?void 0:v.offsetTop,N=q-z,ne=F-E-V;(N!==((p=c.value)==null?void 0:p[0])||ne!==((x=c.value)==null?void 0:x[1]))&&(c.value=[N,ne]);const ee=R>X?R-X:0,oe=Y>Z?Y-Z-V:0;(ee!==d.value[0]||oe!==d.value[1])&&(d.value=[ee,oe]),V&&(b.value=[0,0-V])}},C=v=>{i.value&&(v.preventDefault(),w.value=!0,f(),a.value=[v.x,v.y],ve(window,"mousemove",O),ve(window,"mouseup",U),ve(window,"contextmenu",U))},O=v=>{if(w.value){const p=v.x-a.value[0],x=v.y-a.value[1];let E=c.value[0]+p,z=c.value[1]+x;E<b.value[0]&&(E=b.value[0]),E>d.value[0]&&(E=d.value[0]),z<b.value[1]&&(z=b.value[1]),z>d.value[1]&&(z=d.value[1]),k.value=[E,z]}},U=()=>{w.value=!1,Fe(window,"mousemove",O),Fe(window,"mouseup",U)};return{position:k,handleMoveDown:C}};var pn=ie({name:"Modal",components:{ClientOnly:Pt,ArcoButton:lt,IconHover:Dt,IconClose:Lt,IconInfoCircleFill:an,IconCheckCircleFill:Et,IconExclamationCircleFill:At,IconCloseCircleFill:zt},inheritAttrs:!1,props:{visible:{type:Boolean,default:void 0},defaultVisible:{type:Boolean,default:!1},width:{type:[Number,String]},top:{type:[Number,String]},mask:{type:Boolean,default:!0},title:{type:String},titleAlign:{type:String,default:"center"},alignCenter:{type:Boolean,default:!0},unmountOnClose:Boolean,maskClosable:{type:Boolean,default:!0},hideCancel:{type:Boolean,default:!1},simple:{type:Boolean,default:e=>e.notice},closable:{type:Boolean,default:!0},okText:String,cancelText:String,okLoading:{type:Boolean,default:!1},okButtonProps:{type:Object},cancelButtonProps:{type:Object},footer:{type:Boolean,default:!0},renderToBody:{type:Boolean,default:!0},popupContainer:{type:[String,Object],default:"body"},maskStyle:{type:Object},modalClass:{type:[String,Array]},modalStyle:{type:Object},onBeforeOk:{type:Function},onBeforeCancel:{type:Function},escToClose:{type:Boolean,default:!0},draggable:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},maskAnimationName:{type:String,default:e=>e.fullscreen?"fade-in-standard":"fade-modal"},modalAnimationName:{type:String,default:e=>e.fullscreen?"zoom-in":"zoom-modal"},bodyClass:{type:[String,Array]},bodyStyle:{type:[String,Object,Array]},messageType:{type:String},hideTitle:{type:Boolean,default:!1}},emits:{"update:visible":e=>!0,ok:e=>!0,cancel:e=>!0,open:()=>!0,close:()=>!0,beforeOpen:()=>!0,beforeClose:()=>!0},setup(e,{emit:o}){const{fullscreen:i,popupContainer:r,alignCenter:w}=tt(e),a=ke("modal"),{t:c}=It(),k=h(),b=h(),d=h(e.defaultVisible),f=j(()=>{var S;return(S=e.visible)!=null?S:d.value}),C=h(!1),O=j(()=>e.okLoading||C.value),U=j(()=>e.draggable&&!e.fullscreen),{teleportContainer:v,containerRef:p}=jt({popupContainer:r,visible:f}),x=h(f.value),E=j(()=>e.okText||c("modal.okText")),z=j(()=>e.cancelText||c("modal.cancelText")),{zIndex:R,isLastDialog:Y}=Nt("dialog",{visible:f});let F=!1;const q=S=>{e.escToClose&&S.key===$t.ESC&&Y()&&le(S)},X=()=>{e.escToClose&&!F&&(F=!0,ve(document.documentElement,"keydown",q))},Z=()=>{F=!1,Fe(document.documentElement,"keydown",q)};let V=0;const{position:N,handleMoveDown:ne}=mn({wrapperRef:k,modalRef:b,draggable:U,alignCenter:w}),ee=()=>{V++,C.value&&(C.value=!1),d.value=!1,o("update:visible",!1)},oe=async S=>{const n=V,t=await new Promise(async $=>{var _;if(ae(e.onBeforeOk)){let L=e.onBeforeOk((J=!0)=>$(J));if((Xe(L)||!Ze(L))&&(C.value=!0),Xe(L))try{L=(_=await L)!=null?_:!0}catch(J){throw L=!1,J}Ze(L)&&$(L)}else $(!0)});n===V&&(t?(o("ok",S),ee()):C.value&&(C.value=!1))},le=S=>{var n;let t=!0;ae(e.onBeforeCancel)&&(t=(n=e.onBeforeCancel())!=null?n:!1),t&&(o("cancel",S),ee())},se=h(!1),be=S=>{S.target===k.value&&(se.value=!0)},we=S=>{e.mask&&e.maskClosable&&se.value&&le(S)},Te=()=>{f.value&&(!Wt(k.value,document.activeElement)&&document.activeElement instanceof HTMLElement&&document.activeElement.blur(),o("open"))},Ce=()=>{f.value||(U.value&&(N.value=void 0),x.value=!1,ue(),o("close"))},{setOverflowHidden:re,resetOverflow:ue}=fn(p);nt(()=>{p.value=Ft(e.popupContainer),f.value&&(re(),e.escToClose&&X())}),mt(()=>{ue(),Z()}),je(f,S=>{d.value!==S&&(d.value=S),S?(o("beforeOpen"),x.value=!0,se.value=!1,re(),X()):(o("beforeClose"),Z())}),je(i,()=>{N.value&&(N.value=void 0)});const ce=j(()=>[`${a}-wrapper`,{[`${a}-wrapper-align-center`]:e.alignCenter&&!e.fullscreen,[`${a}-wrapper-moved`]:!!N.value}]),he=j(()=>[`${a}`,e.modalClass,{[`${a}-simple`]:e.simple,[`${a}-draggable`]:U.value,[`${a}-fullscreen`]:e.fullscreen}]),de=j(()=>{var S;const n={...(S=e.modalStyle)!=null?S:{}};return e.width&&!e.fullscreen&&(n.width=ye(e.width)?`${e.width}px`:e.width),!e.alignCenter&&e.top&&(n.top=ye(e.top)?`${e.top}px`:e.top),N.value&&(n.transform=`translate(${N.value[0]}px, ${N.value[1]}px)`),n});return{prefixCls:a,mounted:x,computedVisible:f,containerRef:p,wrapperRef:k,mergedModalStyle:de,okDisplayText:E,cancelDisplayText:z,zIndex:R,handleOk:oe,handleCancel:le,handleMaskClick:we,handleMaskMouseDown:be,handleOpen:Te,handleClose:Ce,mergedOkLoading:O,modalRef:b,wrapperCls:ce,modalCls:he,teleportContainer:v,handleMoveDown:ne}}});function vn(e,o,i,r,w,a){const c=M("icon-info-circle-fill"),k=M("icon-check-circle-fill"),b=M("icon-exclamation-circle-fill"),d=M("icon-close-circle-fill"),f=M("icon-close"),C=M("icon-hover"),O=M("arco-button"),U=M("client-only");return g(),A(U,null,{default:s(()=>[(g(),A(pt,{to:e.teleportContainer,disabled:!e.renderToBody},[!e.unmountOnClose||e.computedVisible||e.mounted?Be((g(),P("div",Oe({key:0,class:`${e.prefixCls}-container`,style:{zIndex:e.zIndex}},e.$attrs),[l(Ke,{name:e.maskAnimationName,appear:""},{default:s(()=>[e.mask?Be((g(),P("div",{key:0,ref:"maskRef",class:W(`${e.prefixCls}-mask`),style:pe(e.maskStyle)},null,6)),[[Me,e.computedVisible]]):B("v-if",!0)]),_:1},8,["name"]),m("div",{ref:"wrapperRef",class:W(e.wrapperCls),onClick:o[2]||(o[2]=te((...v)=>e.handleMaskClick&&e.handleMaskClick(...v),["self"])),onMousedown:o[3]||(o[3]=te((...v)=>e.handleMaskMouseDown&&e.handleMaskMouseDown(...v),["self"]))},[l(Ke,{name:e.modalAnimationName,appear:"",onAfterEnter:e.handleOpen,onAfterLeave:e.handleClose,persisted:""},{default:s(()=>[Be(m("div",{ref:"modalRef",class:W(e.modalCls),style:pe(e.mergedModalStyle)},[!e.hideTitle&&(e.$slots.title||e.title||e.closable)?(g(),P("div",{key:0,class:W(`${e.prefixCls}-header`),onMousedown:o[1]||(o[1]=(...v)=>e.handleMoveDown&&e.handleMoveDown(...v))},[e.$slots.title||e.title?(g(),P("div",{key:0,class:W([`${e.prefixCls}-title`,`${e.prefixCls}-title-align-${e.titleAlign}`])},[e.messageType?(g(),P("div",{key:0,class:W(`${e.prefixCls}-title-icon`)},[e.messageType==="info"?(g(),A(c,{key:0})):B("v-if",!0),e.messageType==="success"?(g(),A(k,{key:1})):B("v-if",!0),e.messageType==="warning"?(g(),A(b,{key:2})):B("v-if",!0),e.messageType==="error"?(g(),A(d,{key:3})):B("v-if",!0)],2)):B("v-if",!0),Ue(e.$slots,"title",{},()=>[T(I(e.title),1)])],2)):B("v-if",!0),!e.simple&&e.closable?(g(),P("div",{key:1,tabindex:"-1",role:"button","aria-label":"Close",class:W(`${e.prefixCls}-close-btn`),onClick:o[0]||(o[0]=(...v)=>e.handleCancel&&e.handleCancel(...v))},[l(C,null,{default:s(()=>[l(f)]),_:1})],2)):B("v-if",!0)],34)):B("v-if",!0),m("div",{class:W([`${e.prefixCls}-body`,e.bodyClass]),style:pe(e.bodyStyle)},[Ue(e.$slots,"default")],6),e.footer?(g(),P("div",{key:1,class:W(`${e.prefixCls}-footer`)},[Ue(e.$slots,"footer",{},()=>[e.hideCancel?B("v-if",!0):(g(),A(O,Oe({key:0},e.cancelButtonProps,{onClick:e.handleCancel}),{default:s(()=>[T(I(e.cancelDisplayText),1)]),_:1},16,["onClick"])),l(O,Oe({type:"primary"},e.okButtonProps,{loading:e.mergedOkLoading,onClick:e.handleOk}),{default:s(()=>[T(I(e.okDisplayText),1)]),_:1},16,["loading","onClick"])])],2)):B("v-if",!0)],6),[[Me,e.computedVisible]])]),_:3},8,["name","onAfterEnter","onAfterLeave"])],34)],16)),[[Me,e.computedVisible||e.mounted]]):B("v-if",!0)],8,["to","disabled"]))]),_:3})}var ge=ot(pn,[["render",vn]]);const De=(e,o)=>{let i=Rt("modal");const r=()=>{d.component&&(d.component.props.visible=!1),ae(e.onOk)&&e.onOk()},w=()=>{d.component&&(d.component.props.visible=!1),ae(e.onCancel)&&e.onCancel()},a=async()=>{await vt(),i&&(Ye(null,i),document.body.removeChild(i)),i=null,ae(e.onClose)&&e.onClose()},c=()=>{d.component&&(d.component.props.visible=!1)},k=f=>{d.component&&Object.entries(f).forEach(([C,O])=>{d.component.props[C]=O})},d=l(ge,{...{visible:!0,renderToBody:!1,unmountOnClose:!0,onOk:r,onCancel:w,onClose:a},...Vt(e,["content","title","footer","visible","unmountOnClose","onOk","onCancel","onClose"]),footer:typeof e.footer=="boolean"?e.footer:void 0},{default:ze(e.content),title:ze(e.title),footer:typeof e.footer!="boolean"?ze(e.footer):void 0});return(o??We._context)&&(d.appContext=o??We._context),Ye(d,i),document.body.appendChild(i),{close:c,update:k}},Pe={open:De,confirm:(e,o)=>{const i={simple:!0,messageType:"warning",...e};return De(i,o)},...Gt.reduce((e,o)=>(e[o]=(i,r)=>{const w={simple:!0,hideCancel:!0,messageType:o,...i};return De(w,r)},e),{})},We=Object.assign(ge,{...Pe,install:(e,o)=>{Re(e,o);const i=Ve(o);e.component(i+ge.name,ge);const r={};for(const w of Object.keys(Pe))r[w]=(a,c=e._context)=>Pe[w](a,c);e.config.globalProperties.$modal=r},_context:null});var Ie=ie({name:"Space",props:{align:{type:String},direction:{type:String,default:"horizontal"},size:{type:[Number,String,Array],default:"small"},wrap:{type:Boolean},fill:{type:Boolean}},setup(e,{slots:o}){const i=ke("space"),r=j(()=>{var k;return(k=e.align)!=null?k:e.direction==="horizontal"?"center":""}),w=j(()=>[i,{[`${i}-${e.direction}`]:e.direction,[`${i}-align-${r.value}`]:r.value,[`${i}-wrap`]:e.wrap,[`${i}-fill`]:e.fill}]);function a(k){if(ye(k))return k;switch(k){case"mini":return 4;case"small":return 8;case"medium":return 16;case"large":return 24;default:return 8}}const c=k=>{const b={},d=`${a(Je(e.size)?e.size[0]:e.size)}px`,f=`${a(Je(e.size)?e.size[1]:e.size)}px`;return k?e.wrap?{marginBottom:f}:{}:(e.direction==="horizontal"&&(b.marginRight=d),(e.direction==="vertical"||e.wrap)&&(b.marginBottom=f),b)};return()=>{var k;const b=Ht((k=o.default)==null?void 0:k.call(o),!0).filter(d=>d.type!==gt);return l("div",{class:w.value},[b.map((d,f)=>{var C,O;const U=o.split&&f>0;return l(Ne,{key:(C=d.key)!=null?C:`item-${f}`},[U&&l("div",{class:`${i}-item-split`,style:c(!1)},[(O=o.split)==null?void 0:O.call(o)]),l("div",{class:`${i}-item`,style:c(f===b.length-1)},[d])])})])}}});const gn=Object.assign(Ie,{install:(e,o)=>{Re(e,o);const i=Ve(o);e.component(i+Ie.name,Ie)}}),yn={class:"token-import-page"},kn={class:"container"},bn={class:"page-header"},wn={class:"header-content"},Tn={class:"header-top"},Cn={class:"card-header"},hn={class:"card-body"},Sn={key:0,class:"tokens-section"},$n={class:"section-header"},_n={class:"header-actions"},Bn={key:0,class:"tokens-grid"},On={class:"token-display"},Mn={class:"token-value"},Un={class:"token-timestamps"},xn={class:"timestamp-item"},zn={class:"timestamp-value"},An={class:"timestamp-item"},En={class:"timestamp-value"},Ln={class:"storage-info"},Dn={class:"storage-item"},Pn={key:0,class:"storage-upgrade"},In={key:1,class:"tokens-list"},jn={style:{"min-width":"120px"}},Nn={style:{"font-weight":"bold","font-size":"1.1em","margin-right":"8px"}},Fn={style:{"min-width":"100px"}},Wn={class:"modal-actions"},Rn={__name:"index",props:{token:String,name:String,server:String,wsUrl:String,api:String,auto:Boolean},setup(e){const o=e,i=Tt(),r=yt(),w=kt(),a=bt(),c=h(!1),k=h(!1),b=h(!1);h(null),h(null);const d=h(null),f=h(null),C=h("manual"),O=h(new Set),U=h(new Set),v=h("card"),p=wt({name:"",token:"",server:"",wsUrl:""}),x={name:[{required:!0,message:"请输入Token名称",trigger:"blur"}],token:[{required:!0,message:"请输入Token字符串",trigger:"blur"}]},E=[{label:"导出所有Token",key:"export"},{label:"导入Token文件",key:"import"},{label:"清理过期Token",key:"clean"},{label:"断开所有连接",key:"disconnect"},{label:"清除所有Token",key:"clear"}],z=()=>{c.value=!0},R=async n=>{O.value.add(n.id);try{if(n.sourceUrl){let t;if(n.sourceUrl.startsWith(window.location.origin)||n.sourceUrl.startsWith("/")||n.sourceUrl.startsWith("http://localhost")||n.sourceUrl.startsWith("http://127.0.0.1"))t=await fetch(n.sourceUrl);else try{t=await fetch(n.sourceUrl,{method:"GET",headers:{Accept:"application/json"},mode:"cors"})}catch(L){throw new Error(`跨域请求被阻止。请确保目标服务器支持CORS。错误详情: ${L.message}`)}if(!t.ok)throw new Error(`请求失败: ${t.status} ${t.statusText}`);const _=await t.json();if(!_.token)throw new Error("返回数据中未找到token字段");a.updateToken(n.id,{token:_.token,server:_.server||n.server,lastRefreshed:Date.now()}),r.success("Token刷新成功")}else{w.info({title:"重新获取Token",content:`Token "${n.name}" 是手动导入的，没有配置自动刷新地址。

请选择以下操作：
1. 重新手动导入新的Token
2. 尝试重新连接现有Token`,positiveText:"重新导入",negativeText:"重新连接",onPositiveClick:()=>{c.value=!0,C.value="manual",importForm.name=n.name,importForm.server=n.server,importForm.wsUrl=n.wsUrl},onNegativeClick:()=>{a.getWebSocketStatus(n.id)==="connected"&&a.closeWebSocketConnection(n.id),setTimeout(()=>{a.createWebSocketConnection(n.id,n.token,n.wsUrl),r.info("正在尝试重新连接...")},500)}});return}a.getWebSocketStatus(n.id)==="connected"&&(a.closeWebSocketConnection(n.id),setTimeout(()=>{a.createWebSocketConnection(n.id,n.token,n.wsUrl)},500))}catch(t){console.error("刷新Token失败:",t),r.error(t.message||"Token刷新失败")}finally{O.value.delete(n.id)}},Y=n=>{w.warning({title:"升级为长期有效",content:`确认要将Token "${n.name}" 升级为长期有效吗？升级后该Token将不会因24小时未使用而被自动清理。`,positiveText:"确认升级",negativeText:"取消",onPositiveClick:()=>{a.upgradeTokenToPermanent(n.id)?r.success(`Token "${n.name}" 已升级为长期有效！`):r.error("升级失败，该Token可能已经是长期有效状态")}})},F=(n,t=!1)=>{const $=xe.value===n.id,_=q(n.id);if($&&_==="connected"&&!t){r.info(`${n.name} 已选中且已连接`);return}if($&&_==="connecting"&&!t){r.info(`${n.name} 正在连接中...`);return}a.selectToken(n.id,t)?t?r.success(`强制重连：${n.name}`):$?r.success(`重新连接：${n.name}`):r.success(`已选择：${n.name}`):r.error(`选择Token失败：${n.name}`)},q=n=>a.getWebSocketStatus(n),X=n=>{const t=q(n);return{connected:"已连接",connecting:"连接中...",disconnected:"已断开",error:"连接错误",disconnecting:"断开中..."}[t]||"未连接"},Z=n=>{const t=q(n);return{connected:"success",connecting:"processing",disconnected:"normal",error:"danger",disconnecting:"warning"}[t]||"normal"},V=n=>{const t=[{label:"编辑",key:"edit",icon:()=>K(D,null,{default:()=>K(Xt)})},{label:"复制Token",key:"copy",icon:()=>K(D,null,{default:()=>K(Jt)})}];return n.importMethod==="url"&&n.sourceUrl?t.push({label:"从URL刷新",key:"refresh-url",icon:()=>K(D,null,{default:()=>K(Yt)})}):t.push({label:"重新获取",key:"refresh",icon:()=>K(D,null,{default:()=>K(Ae)})}),t.push({type:"divider"},{label:"删除",key:"delete",icon:()=>K(D,null,{default:()=>K(qt)}),props:{style:{color:"#e74c3c"}}}),t},N=async(n,t)=>{switch(n){case"edit":ne(t);break;case"copy":oe(t);break;case"refresh":R(t);break;case"refresh-url":R(t);break;case"delete":le(t);break}},ne=n=>{f.value=n,Object.assign(p,{name:n.name,token:n.token,server:n.server||"",wsUrl:n.wsUrl||""}),b.value=!0},ee=async()=>{if(!(!d.value||!f.value))try{await d.value.validate(),a.updateToken(f.value.id,{name:p.name,token:p.token,server:p.server,wsUrl:p.wsUrl}),r.success("Token信息已更新"),b.value=!1,f.value=null}catch{}},oe=async n=>{try{await navigator.clipboard.writeText(n.token),r.success("Token已复制到剪贴板")}catch{r.error("复制失败")}},le=n=>{w.warning({title:"删除Token",content:`确定要删除Token "${n.name}" 吗？此操作无法恢复。`,positiveText:"确定删除",negativeText:"取消",onPositiveClick:()=>{a.removeToken(n.id),r.success("Token已删除")}})},se=n=>{switch(n){case"export":be();break;case"import":we();break;case"clean":Te();break;case"disconnect":Ce();break;case"clear":re();break}},be=()=>{try{const n=a.exportTokens(),t=JSON.stringify(n,null,2),$=new Blob([t],{type:"application/json"}),_=document.createElement("a");_.href=URL.createObjectURL($),_.download=`tokens_backup_${new Date().toISOString().split("T")[0]}.json`,_.click(),r.success("Token数据已导出")}catch{r.error("导出失败")}},we=()=>{const n=document.createElement("input");n.type="file",n.accept=".json",n.onchange=t=>{const $=t.target.files[0];if($){const _=new FileReader;_.onload=L=>{try{const J=JSON.parse(L.target.result),Q=a.importTokens(J);Q.success?r.success(Q.message):r.error(Q.message)}catch{r.error("文件格式错误")}},_.readAsText($)}},n.click()},Te=()=>{const n=a.cleanExpiredTokens();r.success(`已清理 ${n} 个过期Token`)},Ce=()=>{a.gameTokens.forEach(n=>{a.closeWebSocketConnection(n.id)}),r.success("所有连接已断开")},re=()=>{w.error({title:"清除所有Token",content:"确定要清除所有Token吗？此操作无法恢复！",positiveText:"确定清除",negativeText:"取消",onPositiveClick:()=>{a.clearAllTokens(),r.success("所有Token已清除")}})},ue=n=>{if(!n)return"";const t=n.length;return t<=8?n:n.substring(0,4)+"***"+n.substring(t-4)},ce=n=>new Date(n).toLocaleString("zh-CN"),he=()=>{i.push("/admin/dashboard")},de=async n=>{U.value.add(n.id);try{if(a.selectToken(n.id),q(n.id)==="connected"){r.success(`${n.name} 已连接，进入任务管理`),i.push("/admin/dashboard");return}}finally{U.value.delete(n.id)}},S=async()=>{if(o.token||o.api)try{k.value=!0;let n=null;if(o.api){r.info("正在从API获取token...");const t=await fetch(o.api,{method:"GET",headers:{Accept:"application/json"},mode:"cors"});if(!t.ok)throw new Error(`API请求失败: ${t.status} ${t.statusText}`);const $=await t.json();if(!$.token)throw new Error("API返回数据中未找到token字段");n=a.importBase64Token(o.name||$.name||"通过API导入的Token",$.token,{server:o.server||$.server,wsUrl:o.wsUrl,sourceUrl:o.api,importMethod:"url"})}else o.token&&(r.info("正在导入token..."),n=a.importBase64Token(o.name||"通过URL导入的Token",o.token,{server:o.server,wsUrl:o.wsUrl,importMethod:"url"}));if(n&&n.success)r.success(`Token "${n.tokenName}" 导入成功！`),o.auto&&n.token?(a.selectToken(n.token.id),r.success("正在跳转到控制台..."),setTimeout(()=>{i.push("/admin/dashboard")},1500)):i.replace("/tokens");else throw new Error((n==null?void 0:n.message)||"Token导入失败")}catch(n){console.error("URL参数处理失败:",n),r.error(`导入失败: ${n.message}`),i.replace("/tokens")}finally{k.value=!1}};return je(()=>[o.token,o.api],S,{immediate:!1}),nt(async()=>{a.initTokenStore(),await S(),!a.hasTokens&&!o.token&&!o.api&&(c.value=!0)}),(n,t)=>{const $=ft,_=M("n-radio-button"),L=M("n-radio-group"),J=We,Q=M("n-space"),H=M("n-button"),Se=M("n-dropdown"),st=Ot,He=dn,at=gn,Ge=lt,$e=M("n-tag"),it=Kt,rt=M("n-card"),ut=_t,fe=M("n-input"),me=M("n-form-item"),ct=M("n-form"),dt=M("n-modal");return g(),P("div",yn,[m("div",kn,[m("div",bn,[m("div",wn,[m("div",Tn,[t[17]||(t[17]=m("img",{src:Ct,alt:"XYZW",class:"brand-logo"},null,-1)),l($)]),t[18]||(t[18]=m("h1",null,"游戏Token管理",-1))])]),l(J,{visible:c.value,"onUpdate:visible":t[7]||(t[7]=u=>c.value=u),width:"40rem",footer:!1,"default-visible":!y(a).hasTokens},{title:s(()=>[m("h2",null,[l(y(D),null,{default:s(()=>[l(y(Qe))]),_:1}),t[19]||(t[19]=T(" 添加游戏Token ",-1))])]),default:s(()=>[m("div",Cn,[l(L,{value:C.value,"onUpdate:value":t[0]||(t[0]=u=>C.value=u),class:"import-method-tabs",size:"small"},{default:s(()=>[l(_,{value:"manual"},{default:s(()=>[...t[20]||(t[20]=[T(" 手动输入 ",-1)])]),_:1}),l(_,{value:"url"},{default:s(()=>[...t[21]||(t[21]=[T(" URL获取 ",-1)])]),_:1}),l(_,{value:"bin"},{default:s(()=>[...t[22]||(t[22]=[T(" BIN获取 ",-1)])]),_:1})]),_:1},8,["value"])]),m("div",hn,[C.value==="manual"?(g(),A(ht,{key:0,onCancel:t[1]||(t[1]=()=>c.value=!1),onOk:t[2]||(t[2]=()=>c.value=!1)})):B("",!0),C.value==="url"?(g(),A(St,{key:1,onCancel:t[3]||(t[3]=()=>c.value=!1),onOk:t[4]||(t[4]=()=>c.value=!1)})):B("",!0),C.value==="bin"?(g(),A(Bt,{key:2,onCancel:t[5]||(t[5]=()=>c.value=!1),onOk:t[6]||(t[6]=()=>c.value=!1)})):B("",!0)])]),_:1},8,["visible","default-visible"]),y(a).hasTokens?(g(),P("div",Sn,[m("div",$n,[l(Q,{align:"center"},{default:s(()=>[m("h2",null,"我的Token列表 ("+I(y(a).gameTokens.length)+"个)",1),l(L,{value:v.value,"onUpdate:value":t[8]||(t[8]=u=>v.value=u),size:"small"},{default:s(()=>[l(_,{value:"card"},{default:s(()=>[...t[23]||(t[23]=[T("卡片",-1)])]),_:1}),l(_,{value:"list"},{default:s(()=>[...t[24]||(t[24]=[T("列表",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),m("div",_n,[y(a).selectedToken?(g(),A(H,{key:0,type:"success",onClick:he},{icon:s(()=>[l(y(D),null,{default:s(()=>[l(y(_e))]),_:1})]),default:s(()=>[t[25]||(t[25]=T(" 返回控制台 ",-1))]),_:1})):B("",!0),c.value?B("",!0):(g(),A(H,{key:1,type:"primary",onClick:t[9]||(t[9]=u=>c.value=!0)},{icon:s(()=>[l(y(D),null,{default:s(()=>[l(y(Qe))]),_:1})]),default:s(()=>[t[26]||(t[26]=T(" 添加Token ",-1))]),_:1})),l(Se,{options:E,onSelect:se},{default:s(()=>[l(H,null,{icon:s(()=>[l(y(D),null,{default:s(()=>[l(y(Zt))]),_:1})]),default:s(()=>[t[27]||(t[27]=T(" 批量操作 ",-1))]),_:1})]),_:1})])]),v.value==="card"?(g(),P("div",Bn,[(g(!0),P(Ne,null,qe(y(a).gameTokens,u=>(g(),A(it,{key:u.id,class:W({"token-card":!0,active:y(xe)===u.id}),onClick:G=>F(u)},{title:s(()=>[l(at,{class:"token-name"},{default:s(()=>[T(I(u.name)+" ",1),u.server?(g(),A(st,{key:0,color:"red"},{default:s(()=>[T(I(u.server),1)]),_:2},1024)):B("",!0),l(He,{status:Z(u.id),text:X(u.id)},null,8,["status","text"])]),_:2},1024)]),extra:s(()=>[l(Se,{options:V(u),onSelect:G=>N(G,u)},{default:s(()=>[l(H,{text:""},{icon:s(()=>[l(y(D),null,{default:s(()=>[l(y(et))]),_:1})]),_:1})]),_:1},8,["options","onSelect"])]),default:s(()=>[m("div",On,[t[28]||(t[28]=m("span",{class:"token-label"},"Token:",-1)),m("code",Mn,I(ue(u.token)),1)]),l(Ge,{loading:O.value.has(u.id),onClick:te(G=>R(u),["stop"])},{icon:s(()=>[l(y(D),null,{default:s(()=>[l(y(Ae))]),_:1})]),default:s(()=>[T(" "+I(u.sourceUrl?"刷新":"重新获取"),1)]),_:2},1032,["loading","onClick"]),m("div",Un,[m("div",xn,[t[29]||(t[29]=m("span",{class:"timestamp-label"},"创建：",-1)),m("span",zn,I(ce(u.createdAt)),1)]),m("div",An,[t[30]||(t[30]=m("span",{class:"timestamp-label"},"使用：",-1)),m("span",En,I(ce(u.lastUsed)),1)])]),m("div",Ln,[m("div",Dn,[t[31]||(t[31]=m("span",{class:"storage-label"},"存储类型：",-1)),l($e,{size:"small",type:u.importMethod==="url"?"success":"warning"},{default:s(()=>[T(I(u.importMethod==="url"?"长期有效":"临时存储"),1)]),_:2},1032,["type"])]),u.importMethod!=="url"?(g(),P("div",Pn,[l(H,{size:"tiny",type:"success",ghost:"",onClick:te(G=>Y(u),["stop"])},{icon:s(()=>[l(y(D),null,{default:s(()=>[l(y(nn))]),_:1})]),default:s(()=>[t[32]||(t[32]=T(" 升级为长期有效 ",-1))]),_:1},8,["onClick"])])):B("",!0)])]),actions:s(()=>[l(H,{type:"primary",size:"large",block:"",loading:U.value.has(u.id),onClick:G=>de(u)},{icon:s(()=>[l(y(D),null,{default:s(()=>[l(y(_e))]),_:1})]),default:s(()=>[t[33]||(t[33]=T(" 开始任务管理 ",-1))]),_:1},8,["loading","onClick"])]),_:2},1032,["class","onClick"]))),128))])):(g(),P("div",In,[(g(!0),P(Ne,null,qe(y(a).gameTokens,u=>(g(),A(rt,{key:u.id,size:"small",style:{"margin-bottom":"8px"},hoverable:"",onClick:G=>F(u),class:W({active:y(xe)===u.id})},{default:s(()=>[l(Q,{justify:"space-between",align:"center"},{default:s(()=>[l(Q,{align:"center",size:24},{default:s(()=>[m("div",jn,[m("span",Nn,I(u.name),1),u.server?(g(),A($e,{key:0,size:"small",type:"error"},{default:s(()=>[T(I(u.server),1)]),_:2},1024)):B("",!0)]),m("div",Fn,[l(He,{status:Z(u.id),text:X(u.id)},null,8,["status","text"])]),l($e,{size:"small",type:u.importMethod==="url"?"success":"warning"},{default:s(()=>[T(I(u.importMethod==="url"?"长期":"临时"),1)]),_:2},1032,["type"])]),_:2},1024),l(Q,null,{default:s(()=>[l(H,{size:"small",type:"primary",loading:U.value.has(u.id),onClick:te(G=>de(u),["stop"])},{icon:s(()=>[l(y(D),null,{default:s(()=>[l(y(_e))]),_:1})]),default:s(()=>[t[34]||(t[34]=T(" 管理 ",-1))]),_:1},8,["loading","onClick"]),l(H,{size:"small",onClick:te(G=>R(u),["stop"]),loading:O.value.has(u.id)},{icon:s(()=>[l(y(D),null,{default:s(()=>[l(y(Ae))]),_:1})]),default:s(()=>[t[35]||(t[35]=T(" 刷新 ",-1))]),_:1},8,["onClick","loading"]),l(Se,{options:V(u),onSelect:G=>N(G,u)},{default:s(()=>[l(H,{size:"small",circle:"",onClick:t[10]||(t[10]=te(()=>{},["stop"]))},{icon:s(()=>[l(y(D),null,{default:s(()=>[l(y(et))]),_:1})]),_:1})]),_:1},8,["options","onSelect"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]))])):B("",!0),!y(a).hasTokens&&!c.value?(g(),A(ut,{key:1},{image:s(()=>[...t[36]||(t[36]=[m("i",{class:"mdi:bed-empty"},null,-1)])]),default:s(()=>[t[38]||(t[38]=T(" 还没有导入任何Token ",-1)),l(Ge,{type:"link",onClick:z},{default:s(()=>[...t[37]||(t[37]=[T("打开Token管理",-1)])]),_:1})]),_:1})):B("",!0)]),l(dt,{show:b.value,"onUpdate:show":t[16]||(t[16]=u=>b.value=u),preset:"card",title:"编辑Token",style:{width:"500px"}},{footer:s(()=>[m("div",Wn,[l(H,{onClick:t[15]||(t[15]=u=>b.value=!1)},{default:s(()=>[...t[39]||(t[39]=[T(" 取消 ",-1)])]),_:1}),l(H,{type:"primary",onClick:ee},{default:s(()=>[...t[40]||(t[40]=[T(" 保存 ",-1)])]),_:1})])]),default:s(()=>[l(ct,{ref_key:"editFormRef",ref:d,model:p,rules:x,"label-placement":"left","label-width":"80px"},{default:s(()=>[l(me,{label:"名称",path:"name"},{default:s(()=>[l(fe,{value:p.name,"onUpdate:value":t[11]||(t[11]=u=>p.name=u)},null,8,["value"])]),_:1}),l(me,{label:"Token字符串",path:"token"},{default:s(()=>[l(fe,{value:p.token,"onUpdate:value":t[12]||(t[12]=u=>p.token=u),type:"textarea",rows:3,placeholder:"粘贴Token字符串...",clearable:""},null,8,["value"])]),_:1}),l(me,{label:"服务器"},{default:s(()=>[l(fe,{value:p.server,"onUpdate:value":t[13]||(t[13]=u=>p.server=u)},null,8,["value"])]),_:1}),l(me,{label:"WebSocket地址"},{default:s(()=>[l(fe,{value:p.wsUrl,"onUpdate:value":t[14]||(t[14]=u=>p.wsUrl=u)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}},ro=Mt(Rn,[["__scopeId","data-v-f3f07885"]]);export{ro as default};
