import{k as y,K as C,I,r as k,L as x,e as v,w as s,u as l,af as R,b as r,a as n,ah as i,ag as d,aj as F,ai as S,y as B,j as g,N as L,ak as U,i as b,ao as V}from"./index-DyArWEBF.js";import{C as z}from"./CloudUpload-D33L_pSL.js";import{_ as j}from"./plugin-vue_export-helper-DlAUqK2U.js";const q={class:"optional-fields"},O={class:"form-actions"},h=y({__name:"url",emits:["cancel","ok"],setup(A,{emit:_}){const f=C(),u=I(),m=k(),p=k(!1),c=_,w=()=>{c("cancel")},e=x({name:"",url:"",server:"",wsUrl:""}),N={name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:1,max:50,message:"名称长度应在1到50个字符之间",trigger:"blur"}],url:[{required:!0,message:"请输入Token获取地址",trigger:"blur"},{type:"url",message:"请输入有效的URL地址",trigger:"blur"}]},T=async()=>{if(m.value){try{await m.value.validate()}catch{u.error("请修正表单中的错误后再提交");return}p.value=!0;try{const o=await V.get(e.url);if(o.status===200&&o.data&&o.data.token){const a={name:e.name,token:o.data.token,server:e.server||"未知",wsUrl:e.wsUrl||"",id:Date.now().toString()};f.addToken(a),u.success("Token添加成功"),e.name="",e.url="",e.server="",e.wsUrl="",c("ok")}else u.error("接口返回数据格式不正确，未找到token字段")}catch{u.error("获取Token失败，请检查URL地址或网络连接")}finally{p.value=!1}}};return(o,a)=>(b(),v(l(R),{ref_key:"urlFormRef",ref:m,model:e,rules:N,"label-placement":"top",size:"large"},{default:s(()=>[r(l(d),{label:"游戏角色名称",path:"name"},{default:s(()=>[r(l(i),{value:e.name,"onUpdate:value":a[0]||(a[0]=t=>e.name=t),placeholder:"例如：主号战士",clearable:""},null,8,["value"])]),_:1}),r(l(d),{label:"Token获取地址",path:"url"},{feedback:s(()=>[...a[4]||(a[4]=[n("div",{class:"form-tips"},[n("span",{class:"form-tip"}," 接口应返回包含token字段的JSON数据 "),n("span",{class:"form-tip cors-tip"}," 注意：如果是跨域URL，服务器需要支持CORS，否则会被浏览器阻止 ")],-1)])]),default:s(()=>[r(l(i),{value:e.url,"onUpdate:value":a[1]||(a[1]=t=>e.url=t),placeholder:"输入API接口地址...",clearable:""},null,8,["value"])]),_:1}),r(l(S),null,{default:s(()=>[r(l(F),{title:"角色详情 (可选)",name:"optional"},{default:s(()=>[n("div",q,[r(l(d),{label:"服务器"},{default:s(()=>[r(l(i),{value:e.server,"onUpdate:value":a[2]||(a[2]=t=>e.server=t),placeholder:"服务器名称"},null,8,["value"])]),_:1}),r(l(d),{label:"自定义连接地址"},{default:s(()=>[r(l(i),{value:e.wsUrl,"onUpdate:value":a[3]||(a[3]=t=>e.wsUrl=t),placeholder:"留空使用默认连接"},null,8,["value"])]),_:1})])]),_:1})]),_:1}),n("div",O,[r(l(U),{type:"primary",size:"large",block:"",loading:p.value,onClick:T},{icon:s(()=>[r(l(L),null,{default:s(()=>[r(l(z))]),_:1})]),default:s(()=>[a[5]||(a[5]=g(" 获取并添加Token ",-1))]),_:1},8,["loading"]),l(f).hasTokens?(b(),v(l(U),{key:0,size:"large",block:"",onClick:w},{default:s(()=>[...a[6]||(a[6]=[g(" 取消 ",-1)])]),_:1})):B("",!0)])]),_:1},8,["model"]))}}),M=j(h,[["__scopeId","data-v-ffa97e93"]]);export{M as default};
